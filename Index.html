<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Difusividad - MetFisTIC</title>
    <style>
        /* Estilos CSS Globales y de Contenedor */
        /* Usamos Arial y tamaño de fuente base 12pt */
        body { 
            font-family: Arial, sans-serif; 
            font-size: 12pt; 
            background-color: #e9eff5; 
            color: #333; 
            margin: 0; 
            padding: 30px; 
            line-height: 1.6; 
        }
        .container { 
            max-width: 1000px; 
            margin: auto; 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); 
        }
        h1, h2, h3, h4 { 
            font-family: Arial, sans-serif; 
            color: #2c3e50; 
            margin-top: 20px; 
            margin-bottom: 15px; 
        }
        h1 { font-size: 1.8em; text-align: center; color: #0056b3; margin-bottom: 30px; }
        h2 { font-size: 1.5em; border-bottom: 2px solid #007bff; padding-bottom: 8px; color: #0056b3; }
        h3 { font-size: 1.3em; color: #34495e; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        h4 { font-size: 1.1em; color: #5a5a5a; margin-top: 20px; }
        p, li { font-size: 1em; color: #444; }

        /* Estilos de Pestañas (Tabs) */
        .tabs { display: flex; border-bottom: 2px solid #007bff; margin-bottom: 0; background-color: #f8f8f8; border-radius: 8px 8px 0 0; }
        .tab-button { 
            background-color: #e0eafc; 
            border: none;
            padding: 10px 20px; 
            cursor: pointer; 
            font-size: 1em; 
            font-weight: 600;
            color: #0056b3;
            border-radius: 8px 8px 0 0; 
            transition: all 0.3s ease; 
            margin-right: 5px;
            box-shadow: inset 0 -3px 0 rgba(0, 123, 255, 0.3);
        }
        .tab-button:hover { background-color: #cfe2ff; color: #004085; }
        .tab-button.active { 
            background-color: #007bff; 
            color: white; 
            box-shadow: inset 0 -3px 0 #0056b3;
            border-bottom: 2px solid #007bff; 
        }
        .tab-content { 
            background-color: white;
            padding: 30px; 
            border: 1px solid #007bff; 
            border-top: none; 
            border-radius: 0 0 12px 12px; 
            min-height: 650px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        .hidden { display: none; }

        /* Estilos de la Calculadora */
        .option-selector { 
            background-color: #f0f8ff; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            border: 1px solid #b3d9ff;
        }
        .option-selector label { font-weight: 600; color: #004085; font-size: 1em; }
        .input-group { 
            border: 1px solid #dcdcdc; 
            padding: 20px; 
            border-radius: 8px; 
            background-color: #ffffff; 
            margin-top: 15px; 
        }
        .input-group h4 { margin-top: 0; color: #007bff; font-size: 1.1em; border-bottom: 1px dashed #c0e0ff; padding-bottom: 5px; margin-bottom: 15px; }
        
        .conversion-box { 
            background-color: #e6f2ff; 
            border: 1px solid #b3d9ff; 
            padding: 10px 15px; 
            border-radius: 6px; 
            font-size: 0.9em; 
            margin-bottom: 15px; 
            color: #004085;
        }
        .conversion-box strong { color: #007bff; }

        .input-row { display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-end; margin-bottom: 15px; }
        .input-item { display: flex; flex-direction: column; min-width: 150px; max-width: 250px; flex-grow: 1; }
        .input-item label { font-size: 0.9em; margin-bottom: 5px; font-weight: 600; color: #34495e; }
        .input-item input, .input-item select { 
            padding: 8px 10px; 
            border: 1px solid #c0c0c0; 
            border-radius: 5px; 
            font-size: 1em; 
        }
        .small-text { font-size: 0.75em; color: #777; margin-top: 5px; }

        button { 
            background-color: #28a745; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 1em; 
            margin-top: 15px; 
            font-weight: 600;
        }
        button:hover { background-color: #218838; }

        .result-box { 
            margin-top: 25px; 
            padding: 15px; 
            border: 3px solid #007bff; 
            background-color: #e0f2f7; 
            border-radius: 8px; 
            font-size: 1.1em; 
            font-weight: 700; 
            text-align: center; 
            color: #004085;
        }
        .result-box strong { font-size: 1.2em; color: #0056b3; }

        /* Estilos de la Teoría y Manual */
        .theory-section p, .theory-section ul, .theory-section ol, #manual p, #manual ol { 
            text-align: justify; 
            line-height: 1.6; 
            font-size: 1em; 
        }

        /* Estilos de la Ecuación sin símbolos LaTeX */
        .equation-box { 
            font-style: italic; 
            font-size: 1.1em; 
            margin: 20px 0; 
            padding: 12px; 
            background-color: #eef7ff; 
            border-left: 6px solid #007bff; 
            border-radius: 8px;
            color: #0056b3;
            text-align: center;
            overflow-x: auto; 
        }
        .equation-content { font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.1em; }

        /* Estilos de la Tabla (Mejorados) */
        .theory-table { width: 100%; border-collapse: collapse; margin-top: 25px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08); border-radius: 8px; overflow: hidden; }
        .theory-table th, .theory-table td { border: 1px solid #e0e0e0; padding: 10px 12px; text-align: center; font-size: 0.95em; }
        .theory-table th { background-color: #007bff; color: white; font-weight: 600; text-transform: uppercase; font-size: 1em; }
        .theory-table tr:nth-child(even) { background-color: #f8f8f8; }
        .theory-table tr:hover { background-color: #eef7ff; }

        .table-header-interstitial { background-color: #0056b3 !important; color: white !important; font-weight: bold; text-align: center !important; font-size: 1.05em !important; }
        .table-header-self { background-color: #28a745 !important; color: white !important; font-weight: bold; text-align: center !important; font-size: 1.05em !important; }
        .table-header-heterogeneous { background-color: #ffc107 !important; color: #333 !important; font-weight: bold; text-align: center !important; font-size: 1.05em !important; }

        .theory-image { max-width: 90%; height: auto; display: block; margin: 20px auto; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .image-caption { text-align: center; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic; }

        /* Pie de página */
        .footer-message { 
            margin-top: 30px; 
            padding: 15px; 
            background-color: #dbe9f6; 
            color: #004085; 
            border: 1px solid #b3d9ff; 
            border-radius: 10px; 
            text-align: center; 
            font-size: 0.85em;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Calculadora de Difusividad</h1>
    <div class="tabs">
        <button class="tab-button active" onclick="openTab(event, 'calculator')">1. Calculadora (D)</button>
        <button class="tab-button" onclick="openTab(event, 'theory')">2. Teoría de la Difusión</button>
        <button class="tab-button" onclick="openTab(event, 'manual')">3. Manual de Uso</button>
    </div>

    <div id="calculator" class="tab-content">
        <h2>Calculadora de Difusividad (D)</h2>

        <div class="option-selector">
            <label>Selecciona el modo de uso de la calculadora:</label><br>
            <input type="radio" id="option1" name="calc_option" value="table" checked onclick="toggleCalcMode()">
            <label for="option1">1. Usar Tabla de Datos</label>
            <input type="radio" id="option2" name="calc_option" value="manual" onclick="toggleCalcMode()">
            <label for="option2">2. Usar Calculadora sin Tabla (Manual)</label>
        </div>

        <div id="table-mode" class="input-group">
            <h4>Calculadora con Tabla de Datos</h4>
            
            <p>Utiliza datos predefinidos de Q (Energía de Activación) y D₀ (Factor de Frecuencia) para calcular la difusividad (D).</p>
            <div class="conversion-box">
                Constante de los Gases Ideales (R): <strong>8,314463 J/(mol·K)</strong>
            </div>

            <div class="input-row">
                <div class="input-item">
                    <label for="temp-table">Temperatura (T):</label>
                    <input type="number" id="temp-table" value="" step="1" oninput="calculateTableMode()" placeholder="Ej: 800">
                </div>
                <div class="input-item">
                    <label for="temp-unit-table">Unidad:</label>
                    <select id="temp-unit-table" onchange="calculateTableMode()">
                        <option value="K">Kelvin (K)</option>
                        <option value="C">Grados Centígrados (°C)</option>
                        <option value="F">Grados Fahrenheit (°F)</option>
                    </select>
                </div>
                <div class="input-item" style="min-width: 400px; max-width: none;">
                    <span class="small-text">La temperatura se convierte automáticamente a Kelvin para el cálculo.</span>
                </div>
            </div>

            <div class="input-row">
                <div class="input-item" style="min-width: 250px;">
                    <label for="mechanism">Tipo de Difusión:</label>
                    <select id="mechanism" onchange="populatePairs()">
                        <option value="">-- Seleccione Tipo --</option>
                        <option value="interstitial">Difusión Intersticial</option>
                        <option value="self">Autodifusión</option>
                        <option value="heterogeneous">Difusión Heterogénea</option>
                    </select>
                </div>
                <div class="input-item" style="min-width: 250px;">
                    <label for="pair">Par de Difusión:</label>
                    <select id="pair" onchange="setTableValues()">
                        <option value="">-- Seleccione Par --</option>
                    </select>
                </div>
            </div>
            
            <div class="input-row">
                <div class="input-item">
                    <label for="Q-table">Energía de Activación (Q):</label>
                    <input type="text" id="Q-table" readonly placeholder="kJ/mol">
                    <span class="small-text">Convertido a J/mol (x 1000) para el cálculo.</span>
                </div>
                <div class="input-item">
                    <label for="D0-table">Factor de Frecuencia (D₀):</label>
                    <input type="text" id="D0-table" readonly placeholder="m²/s (x10⁴ de tabla)">
                    <span class="small-text">Convertido a m²/s (x 10⁻⁴) para el cálculo.</span>
                </div>
            </div>

            <button onclick="calculateTableMode()">Calcular Difusividad (D)</button>
        </div>

        <div id="manual-mode" class="input-group hidden">
            <h4>Calculadora sin Tabla (Manual)</h4>
            
            <p>Introduce tus propios valores para Q, T y D₀ y selecciona las constantes apropiadas.</p>

            <div class="input-row">
                <div class="input-item">
                    <label for="Q-manual">Energía de Activación (Q):</label>
                    <input type="text" id="Q-manual" placeholder="Ej: 125,5e3 (usar coma)">
                </div>
                <div class="input-item">
                    <label for="Q-unit-manual">Unidad de Q:</label>
                    <select id="Q-unit-manual" onchange="setManualK()">
                        <option value="J/atom">J/átomo</option>
                        <option value="eV/atom">eV/átomo</option>
                        <option value="J/mol">J/mol</option>
                        <option value="Cal/mol">Cal/mol</option>
                    </select>
                </div>
                <div class="input-item">
                    <label for="K-manual">Constante (K):</label>
                    <input type="text" id="K-manual" readonly placeholder="Valor y Unidad">
                    <span class="small-text">Se ajusta automáticamente según la unidad de Q.</span>
                </div>
            </div>

            <div class="input-row">
                <div class="input-item">
                    <label for="temp-manual">Temperatura (T):</label>
                    <input type="text" id="temp-manual" placeholder="Ej: 900 (usar coma)">
                </div>
                <div class="input-item">
                    <label for="temp-unit-manual">Unidad de T:</label>
                    <select id="temp-unit-manual">
                        <option value="K">Kelvin (K)</option>
                        <option value="C">Grados Centígrados (°C)</option>
                        <option value="F">Grados Fahrenheit (°F)</option>
                    </select>
                </div>
                <div class="input-item">
                    <label for="D0-manual">Factor de Frecuencia (D₀):</label>
                    <input type="text" id="D0-manual" placeholder="En m²/s. Ej: 2,5e-4">
                    <span class="small-text">Unidad requerida: m²/s.</span>
                </div>
            </div>

            <button onclick="calculateManualMode()">Calcular Difusividad (D)</button>
        </div>

        <div id="result-section" class="hidden">
            <div class="result-box">
                Difusividad Calculada (D): <strong><span id="difusivity-result"></span></strong>
            </div>
        </div>
    </div>

    <div id="theory" class="tab-content theory-section hidden">
        <h2>Teoría de la Difusión</h2>
        
        <p>La difusión se refiere al flujo neto de cualquier especie, como iones, átomos, electrones, orificios y moléculas. La magnitud de este flujo depende del gradiente de concentración y de la temperatura. Es un proceso crucial en la ingeniería y ciencia de materiales. </p>

        <h3>Ecuación de Difusividad (Arrhenius)</h3>
        <p>La velocidad de difusión se cuantifica con el coeficiente de difusividad (D), regido por la Ecuación de Arrhenius, que muestra su dependencia exponencial con la temperatura:</p>
        <div class="equation-box">
            <p>D = D₀ * exp( -Q / (K * T) )</p>
        </div>
        <ul>
            <li>D: Coeficiente de Difusividad (m²/s).</li>
            <li>D₀: Factor de Frecuencia o Pre-exponencial (m²/s).</li>
            <li>Q: Energía de Activación (J/mol o J/átomo). La barrera energética para el salto atómico.</li>
            <li>K: Constante. Es R (Constante de Gases Ideales) si Q es por mol, o B (Constante de Boltzmann) si Q es por átomo.</li>
            <li>T: Temperatura Absoluta (Kelvin, K).</li>
        </ul>

        <hr>

        <h3>Flujo de Difusión y Ley de Fick (Estado No Estacionario)</h3>
        <p>El flujo de difusión se define como la cantidad de átomos que pasan a través de un plano de unidad de área por unidad de tiempo. Se describe por las leyes de Fick, siendo la **Segunda Ley de Fick** la que se aplica en procesos donde la concentración cambia con el tiempo (Difusión No Estacionaria), como la cementación:</p>
        
        <img src="https://i.ytimg.com/vi/FYwSzuwMAAA/maxresdefault.jpg?sqp=-oaymwEmCIAKENAF8quKqQMa8AEB-AH-CYAC0AWKAgwIABABGDQgZyhyMA8=&rs=AOn4CLApye_CLB2PgND9Tzy85Kzpm8ii9A" alt="Esquema del flujo neto de átomos debido a un gradiente de concentración" class="theory-image">
        <p class="image-caption">Fig. 1: Representación esquemática del flujo neto de átomos (J) a través de una sección transversal, causado por el gradiente de concentración (dC/dx).</p>

        <p>En estos casos (como la carburización), la concentración de los átomos difusores cerca de la superficie es alta y disminuye a medida que se profundiza en el material. Este fenómeno genera el **perfil de concentración**:</p>
        
        <img src="https://tse4.mm.bing.net/th/id/OIP.-NDinzEZu83V5D9m306jsAAAAA?pid=Api&P=0&h=180" alt="Micrografía y perfil de cementación de acero" class="theory-image">
        <p class="image-caption">Fig. 2: Perfil de concentración (izquierda) mostrando cómo la concentración de carbono disminuye con la distancia desde la superficie en un proceso de cementación. Micrografía (derecha) que ilustra la diferencia estructural entre la caja (superficie) y el núcleo.</p>

        <p>Las leyes que rigen este comportamiento son:</p>
        <ul>
            <li>Primera Ley de Fick (Estado Estacionario):
                <div class="equation-box"><p>J = -D * (dC/dx)</p></div>
            </li>
            <li>Segunda Ley de Fick (Estado No Estacionario):
                <div class="equation-box"><p>dC/dt = d/dx ( D * dC/dx )</p></div>
            </li>
        </ul>
        
        <hr>

        <h3>Tipos de Mecanismos de Difusión</h3>
        <p>Los átomos en un sólido se mueven de una posición a otra de varias maneras, dependiendo de la estructura cristalina y el tamaño relativo de los átomos involucrados. Los mecanismos de difusión más comunes son la difusión intersticial y la difusión por vacancias (que incluye la autodifusión y la difusión sustitucional/heterogénea).</p>

        <h4>1. Difusión Intersticial</h4>
        <p>Este mecanismo ocurre cuando los átomos pequeños (como el carbono, hidrógeno o nitrógeno) se mueven entre los átomos de la red cristalina principal, ocupando los espacios intersticiales. Es un proceso generalmente más rápido porque los átomos intersticiales son mucho más pequeños que los átomos de la red anfitriona, y hay muchos sitios intersticiales vacantes adyacentes a donde se encuentra el átomo.</p>
        <img src="https://www.researchgate.net/profile/Daniel_Sanchez_Huerta/publication/281961340/figure/download/fig6/AS:332530831118341@1456292936851/Figura-13-Difusion-intersticial-elaboracion-propia.png" alt="Esquema de difusión intersticial" class="theory-image">
        <p class="image-caption">Fig. 3: Representación de un átomo difusor (más pequeño) moviéndose a través de los intersticios de la red cristalina.</p>

        <h4>2. Difusión por Vacancias (Sustitucional)</h4>
        <p>Este mecanismo implica el intercambio de un átomo de la red con una vacancia (un sitio atómico desocupado). Para que esto ocurra, debe haber una vacancia adyacente a un átomo, y el átomo debe tener suficiente energía para romper sus enlaces con los átomos vecinos y saltar a la vacancia. Este proceso es común para los átomos que son de tamaño similar a los de la red anfitriona.</p>
        <ul>
            <li><strong>Autodifusión:</strong> Es un tipo de difusión por vacancias donde los átomos que se mueven son del mismo tipo que los átomos de la red anfitriona. No hay un cambio neto en la composición.</li>
            <li><strong>Difusión Heterogénea (o Sustitucional):</strong> Ocurre cuando átomos de un elemento se difunden en una red formada por átomos de un elemento diferente, y estos átomos difusores son de tamaño similar a los de la red, por lo que intercambian posiciones con las vacancias de la red anfitriona.</li>
        </ul>
        <img src="https://image1.slideserve.com/2095530/slide4-l.jpg" alt="Esquema de difusión por vacancias o sustitucional" class="theory-image">
        <p class="image-caption">Fig. 4: Ilustración de un átomo de una aleación (verde) intercambiando posición con una vacancia en la red cristalina.</p>
        
        <hr>

        <p>En resumen, los mecanismos de difusión son fundamentales para entender cómo los materiales cambian su composición y propiedades a nivel atómico.</p>
        <img src="https://i.ytimg.com/vi/yIF4p8TWp2k/maxresdefault.jpg" alt="Comparación de mecanismos de difusión" class="theory-image">
        <p class="image-caption">Fig. 5: Comparación visual de los mecanismos de difusión intersticial, por vacancias y en límites de grano.</p>

        <h3>Parámetros de Difusión por Tipo y Mecanismo</h3>
        <p>La siguiente tabla presenta valores de referencia para la Energía de Activación (Q) y el Factor de Frecuencia (D₀), agrupados por el tipo de difusión predominante, los cuales son esenciales para la calculadora.</p>
        <table class="theory-table">
            <thead>
                <tr>
                    <th rowspan="2">Par de Difusión</th>
                    <th rowspan="2">Mecanismo Principal</th>
                    <th colspan="2">Parámetros de Difusión</th>
                </tr>
                <tr>
                    <th>Q (Energía de Activación)<br>(kJ/mol)</th>
                    <th>D₀ (Factor Pre-exponencial)<br>(m²/s) x 10⁴</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="4" class="table-header-interstitial">Difusión Intersticial</td></tr>
                <tr><td>C en hierro CCCa</td><td>Intersticial</td><td>137,7</td><td>0,23</td></tr>
                <tr><td>C en hierro CCCu</td><td>Intersticial</td><td>87,45</td><td>0,011</td></tr>
                <tr><td>N en hierro CCCa</td><td>Intersticial</td><td>144,7</td><td>0,0034</td></tr>
                <tr><td>N en hierro CCCu</td><td>Intersticial</td><td>76,6</td><td>0,0047</td></tr>
                <tr><td>H en hierro CCCa</td><td>Intersticial</td><td>43,1</td><td>0,0063</td></tr>
                <tr><td>H en hierro CCCu</td><td>Intersticial</td><td>15,1</td><td>0,0012</td></tr>
                <tr><td colspan="4" class="table-header-self">Autodifusión (Vacancia)</td></tr>
                <tr><td>Pb en Pb CCCa</td><td>Vacancia</td><td>108,4</td><td>1,27</td></tr>
                <tr><td>Al en Al CCCa</td><td>Vacancia</td><td>134,7</td><td>0,10</td></tr>
                <tr><td>Cu en Cu CCCa</td><td>Vacancia</td><td>206,3</td><td>0,36</td></tr>
                <tr><td>Fe en Fe CCCa</td><td>Vacancia</td><td>279,1</td><td>0,65</td></tr>
                <tr><td>Zn en Zn CH</td><td>Vacancia</td><td>91,2</td><td>0,1</td></tr>
                <tr><td>Mg en Mg CH</td><td>Vacancia</td><td>134,7</td><td>1,0</td></tr>
                <tr><td>Fe en Fe CCCu</td><td>Vacancia</td><td>246,4</td><td>4,1</td></tr>
                <tr><td>W en W CCCu</td><td>Vacancia</td><td>600</td><td>1,88</td></tr>
                <tr><td>Si en Si (covalente)</td><td>Vacancia</td><td>460,3</td><td>1800,0</td></tr>
                <tr><td>C en C (covalente)</td><td>Vacancia</td><td>682,0</td><td>5.0</td></tr>
                <tr><td colspan="4" class="table-header-heterogeneous">Difusión Heterogénea (Vacancia)</td></tr>
                <tr><td>Ni en Cu</td><td>Vacancia</td><td>242,3</td><td>2,3</td></tr>
                <tr><td>Cu en Ni</td><td>Vacancia</td><td>257,3</td><td>0,65</td></tr>
                <tr><td>Zn en Cu</td><td>Vacancia</td><td>183,7</td><td>0,78</td></tr>
                <tr><td>Ni en hierro CCCa</td><td>Vacancia</td><td>267,8</td><td>4,1</td></tr>
                <tr><td>Au en Ag</td><td>Vacancia</td><td>190,4</td><td>0,26</td></tr>
                <tr><td>Ag en Au</td><td>Vacancia</td><td>168,2</td><td>0,072</td></tr>
                <tr><td>Al en Cu</td><td>Vacancia</td><td>165,3</td><td>0,045</td></tr>
                <tr><td>Al en Al2O3</td><td>Vacancia</td><td>477</td><td>28.0</td></tr>
                <tr><td>O en Al2O3</td><td>Vacancia</td><td>636</td><td>1900.0</td></tr>
                <tr><td>Mg en MgO</td><td>Vacancia</td><td>330,5</td><td>0,249</td></tr>
                <tr><td>O en MgO</td><td>Vacancia</td><td>343,5</td><td>0,000043</td></tr>
            </tbody>
        </table>
    </div>

    <div id="manual" class="tab-content hidden">
        <h2>Manual de Uso de la Aplicación</h2>

        <p>Esta aplicación está diseñada para explorar el concepto de la difusividad (D). Para asegurar cálculos correctos, siga estas reglas:</p>

        <h3>1. Convenciones de Entrada de Datos</h3>
        <ol>
            <li>Decimales: Utilice la coma (,) como separador decimal. Ejemplo: 3,14.</li>
            <li>Notación Científica: Utilice la letra 'e' para el exponente. Ejemplo: 1,27 x 10⁻⁴ se escribe como 1,27e-4.</li>
        </ol>

        <h3>2. Modos de Operación</h3>
        <ul>
            <li>Modo "Usar Tabla de Datos":
                <ul>
                    <li>Solo ingrese la Temperatura y seleccione el Par de Difusión.</li>
                    <li>Los valores de Q (kJ/mol) y D₀ (m²/s x 10⁴) se cargan automáticamente.</li>
                    <li>La aplicación convierte internamente Q a J/mol (x 1000) y D₀ a m²/s (x 10⁻⁴) para usar la constante R.</li>
                </ul>
            </li>
            <li>Modo "Usar Calculadora sin Tabla (Manual)":
                <ul>
                    <li>Introduzca valores personalizados para Q, T, y D₀.</li>
                    <li>D₀ debe estar en m²/s.</li>
                    <li>Seleccione la unidad correcta para Q; la constante K (R o B) se ajustará automáticamente.</li>
                    <li>Cualquier unidad de temperatura (K, °C, °F) se convierte a Kelvin (K).</li>
                </ul>
            </li>
        </ul>
        <h3>3. Interpretación de Resultados</h3>
        <p>El resultado de la Difusividad (D) se muestra en m²/s en notación científica. Un valor mayor de D implica una difusión más rápida.</p>
    </div>

    <div class="footer-message">
        Esta calculadora forma parte del proyecto MetFisTIC "Módulo TIC de Autoestudio que incorpora Simulaciones e IA para Aprendizaje de Conceptos Fundamentales sobre Metalurgia Física", dirigido por los profesores Pedro Delvasto y Walter Pardavé. MetFisTIC fue financiado por la Vicerrectoría Académica de la Universidad Industrial de Santander (2025). La calculadora fue elaborada por Andrés Felipe Caro Miranda y revisada por Alisson Vanessa Guerrero Salcedo!
    </div>

</div>

<script>
    // Constante de los gases ideales en J/(mol·K)
    const R_GASES = 8.314463; 

    // Base de datos de la tabla (Q en kJ/mol, D0 en m^2/s x 10^4)
    const DIFFUSION_DATA = {
        interstitial: {
            "C en hierro CCCa": { Q: 137.7, D0: 0.23 },
            "C en hierro CCCu": { Q: 87.45, D0: 0.011 },
            "N en hierro CCCa": { Q: 144.7, D0: 0.0034 },
            "N en hierro CCCu": { Q: 76.6, D0: 0.0047 },
            "H en hierro CCCa": { Q: 43.1, D0: 0.0063 },
            "H en hierro CCCu": { Q: 15.1, D0: 0.0012 }
        },
        self: {
            "Pb en Pb CCCa": { Q: 108.4, D0: 1.27 },
            "Al en Al CCCa": { Q: 134.7, D0: 0.10 },
            "Cu en Cu CCCa": { Q: 206.3, D0: 0.36 },
            "Fe en Fe CCCa": { Q: 279.1, D0: 0.65 },
            "Zn en Zn CH": { Q: 91.2, D0: 0.1 },
            "Mg en Mg CH": { Q: 134.7, D0: 1.0 },
            "Fe en Fe CCCu": { Q: 246.4, D0: 4.1 },
            "W en W CCCu": { Q: 600, D0: 1.88 },
            "Si en Si (covalente)": { Q: 460.3, D0: 1800.0 },
            "C en C (covalente)": { Q: 682.0, D0: 5.0 }
        },
        heterogeneous: {
            "Ni en Cu": { Q: 242.3, D0: 2.3 },
            "Cu en Ni": { Q: 257.3, D0: 0.65 },
            "Zn en Cu": { Q: 183.7, D0: 0.78 },
            "Ni en hierro CCCa": { Q: 267.8, D0: 4.1 },
            "Au en Ag": { Q: 190.4, D0: 0.26 },
            "Ag en Au": { Q: 168.2, D0: 0.072 },
            "Al en Cu": { Q: 165.3, D0: 0.045 },
            "Al en Al2O3": { Q: 477, D0: 28.0 },
            "O en Al2O3": { Q: 636, D0: 1900.0 },
            "Mg en MgO": { Q: 330.5, D0: 0.249 },
            "O en MgO": { Q: 343.5, D0: 0.000043 }
        }
    };

    // Constantes para el modo manual (K)
    const K_CONSTANTS = {
        "J/atom": { value: 1.380649e-23, unit: "J/K (B)" }, // Boltzmann
        "eV/atom": { value: 8.617333262e-5, unit: "eV/K (B)" }, // Boltzmann
        "J/mol": { value: 8.314462618, unit: "J/(mol·K) (R)" }, // Gases Ideales
        "Cal/mol": { value: 1.987204259, unit: "cal/(mol·K) (R)" } // Gases Ideales
    };
    
    /**
     * Función para cambiar entre pestañas.
     */
    function openTab(evt, tabName) {
        let i, tabcontent, tablinks;
        
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].classList.add("hidden");
        }
        
        tablinks = document.getElementsByClassName("tab-button");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        
        document.getElementById(tabName).classList.remove("hidden");
        evt.currentTarget.className += " active";
    }

    /**
     * Alterna entre los modos de la calculadora: Tabla o Manual.
     */
    function toggleCalcMode() {
        const selectedMode = document.querySelector('input[name="calc_option"]:checked').value;
        document.getElementById('table-mode').classList.toggle('hidden', selectedMode !== 'table');
        document.getElementById('manual-mode').classList.toggle('hidden', selectedMode !== 'manual');
        document.getElementById('result-section').classList.add('hidden'); 
        
        if (selectedMode === 'manual') {
            setManualK();
        } else {
            populatePairs();
            // No calcular de inicio, solo limpiar
            document.getElementById('Q-table').value = '';
            document.getElementById('D0-table').value = '';
        }
    }

    /**
     * Reemplaza coma por punto para el cálculo y maneja la notación científica 'e'.
     */
    function parseNumber(str) {
        if (!str) return NaN;
        // Reemplazar coma por punto para el formato JS y parsear la notación científica 'e'
        const cleanedStr = String(str).replace(',', '.');
        return parseFloat(cleanedStr);
    }
    
    /**
     * Formatea un número en notación científica con 'e' y coma como decimal.
     */
    function formatScientific(num, decimals = 6) {
        if (typeof num !== 'number' || isNaN(num)) return 'Error';
        const str = num.toExponential(decimals); 
        // Reemplazar punto decimal por coma y 'e+' por 'e' (o 'e-')
        return str.replace('.', ',').replace('e+', 'e');
    }
    
    /**
     * Convierte la temperatura a Kelvin.
     */
    function convertToKelvin(temp, unit) {
        if (unit === 'K') return temp;
        if (unit === 'C') return temp + 273.15;
        // (°F − 32) × 5/9 + 273.15 = K
        if (unit === 'F') return (temp - 32) * 5/9 + 273.15;
        return NaN;
    }

    // ################### Lógica Modo Tabla ###################

    /**
     * Llena el selector de pares de difusión según el mecanismo elegido.
     */
    function populatePairs() {
        const mechanism = document.getElementById('mechanism').value;
        const pairSelect = document.getElementById('pair');
        pairSelect.innerHTML = '<option value="">-- Seleccione Par --</option>';
        document.getElementById('Q-table').value = '';
        document.getElementById('D0-table').value = '';
        document.getElementById('result-section').classList.add('hidden');

        if (mechanism && DIFFUSION_DATA[mechanism]) {
            const pairs = Object.keys(DIFFUSION_DATA[mechanism]);
            pairs.forEach(pair => {
                const option = document.createElement('option');
                option.value = pair;
                option.textContent = pair;
                pairSelect.appendChild(option);
            });
        }
        setTableValues(); 
    }

    /**
     * Establece los valores de Q y D0 en los cuadros de texto a partir de la tabla.
     */
    function setTableValues() {
        const mechanism = document.getElementById('mechanism').value;
        const pair = document.getElementById('pair').value;
        document.getElementById('result-section').classList.add('hidden');

        if (mechanism && pair) {
            const data = DIFFUSION_DATA[mechanism][pair];
            // Mostrar los valores tal cual están en la tabla (kJ/mol y x10^4)
            document.getElementById('Q-table').value = `${formatScientific(data.Q, 3)} kJ/mol`;
            document.getElementById('D0-table').value = `${formatScientific(data.D0, 5)} x 10^4 m^2/s`;
            calculateTableMode(); // Intenta calcular automáticamente al seleccionar el par
        } else {
            document.getElementById('Q-table').value = '';
            document.getElementById('D0-table').value = '';
        }
    }

    /**
     * Realiza el cálculo de difusividad para el modo tabla.
     */
    function calculateTableMode() {
        const tempInput = document.getElementById('temp-table');
        const tempUnit = document.getElementById('temp-unit-table').value;
        const mechanism = document.getElementById('mechanism').value;
        const pair = document.getElementById('pair').value;

        if (!tempInput.value || !mechanism || !pair) {
            document.getElementById('result-section').classList.add('hidden');
            return;
        }

        const T_val = parseNumber(tempInput.value);
        const T = convertToKelvin(T_val, tempUnit);
        
        if (isNaN(T) || T <= 0) {
            document.getElementById('difusivity-result').textContent = 'Error: Temperatura inválida.';
            document.getElementById('result-section').classList.remove('hidden');
            return;
        }

        const data = DIFFUSION_DATA[mechanism][pair];
        
        // Q: kJ/mol -> J/mol (* 1000)
        const Q_J = data.Q * 1000;
        // D0: m^2/s x 10^4 -> m^2/s (* 10^-4)
        const D0_m2s = data.D0 * 1e-4;

        // Fórmula: D = D0 * exp(-Q / (R * T))
        const exponent = -Q_J / (R_GASES * T);
        const D = D0_m2s * Math.exp(exponent);

        displayResult(D);
    }

    // ################### Lógica Modo Manual ###################

    /**
     * Establece la constante K (R o B) según la unidad de Q elegida.
     */
    function setManualK() {
        const QUnit = document.getElementById('Q-unit-manual').value;
        const KData = K_CONSTANTS[QUnit];
        document.getElementById('result-section').classList.add('hidden');
        if (KData) {
            // Usamos 10 decimales para precisión para la constante
            document.getElementById('K-manual').value = `${formatScientific(KData.value, 10)} ${KData.unit}`;
        }
    }

    /**
     * Realiza el cálculo de difusividad para el modo manual.
     */
    function calculateManualMode() {
        const QInput = document.getElementById('Q-manual').value;
        const QUnit = document.getElementById('Q-unit-manual').value;
        const TInput = document.getElementById('temp-manual').value;
        const TUnit = document.getElementById('temp-unit-manual').value;
        const D0Input = document.getElementById('D0-manual').value;

        if (!QInput || !TInput || !D0Input) {
            alert('Error: Todos los campos deben estar llenos en el modo manual.');
            return;
        }

        const Q = parseNumber(QInput);
        const T_val = parseNumber(TInput);
        const D0 = parseNumber(D0Input);

        if (isNaN(Q) || isNaN(T_val) || isNaN(D0)) {
            alert('Error: Revise el formato numérico. Use coma (",") como decimal y notación científica "e#" (ej: 1,5e-3).');
            return;
        }
        
        const T = convertToKelvin(T_val, TUnit);
        if (isNaN(T) || T <= 0) {
            alert('Error: Ingrese una temperatura válida y positiva.');
            return;
        }

        const K = K_CONSTANTS[QUnit].value;

        // Fórmula: D = D0 * exp(-Q / (K * T))
        const exponent = -Q / (K * T);
        const D = D0 * Math.exp(exponent);

        displayResult(D);
    }

    // ################### Funciones Comunes de Resultado ###################

    /**
     * Muestra el resultado de la difusividad.
     */
    function displayResult(D) {
        const resultSection = document.getElementById('result-section');
        const resultElement = document.getElementById('difusivity-result');

        resultSection.classList.remove('hidden');
        // Mostrar el resultado en notación científica con coma.
        resultElement.textContent = `${formatScientific(D, 6)} m^2/s`;
    }

    // Inicialización al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
        // Inicializar con la primera pestaña activa
        openTab({ currentTarget: document.querySelector('.tab-button.active') }, 'calculator');
        // Inicializar los datos del modo tabla (rellenar los selects)
        populatePairs();
        // Inicializar la constante K del modo manual
        setManualK();
    });

</script>
</body>

</html>
